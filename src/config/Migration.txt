CREATE DATABASE IF NOT EXISTS SistemaDeVendas;
USE SistemaDeVendas;
CREATE TABLE IF NOT EXISTS Pessoa (id INT NOT NULL AUTO_INCREMENT, nome varchar(30) NOT NULL, endereco varchar(50) NOT NULL, cidade varchar(30) NOT NULL, estado varchar(2) NOT NULL, celular varchar(11) NOT NULL, email varchar(50) NOT NULL, PRIMARY KEY (id));
CREATE TABLE IF NOT EXISTS Funcionario (id INT NOT NULL AUTO_INCREMENT, salario decimal(10, 2) NOT NULL, cargo varchar(20) NOT NULL, dataInicio date NOT NULL, PRIMARY KEY (id), idPessoa INT NOT NULL);
CREATE TABLE IF NOT EXISTS Cliente (cpf varchar(11) NOT NULL, PRIMARY KEY (cpf), idPessoa INT NOT NULL);
CREATE TABLE IF NOT EXISTS Venda (id INT NOT NULL AUTO_INCREMENT, dataVenda date NOT NULL, valorTotal decimal(10, 2) NOT NULL, tempoGarantia INT NOT NULL, tipoPagamento varchar(20) NOT NULL, dataPagamento date NOT NULL, valorPagamento decimal(10, 2) NOT NULL, PRIMARY KEY (id), idFuncionario INT NOT NULL, cpfCliente varchar(11) NOT NULL);
CREATE TABLE IF NOT EXISTS Produto (id INT NOT NULL AUTO_INCREMENT, valorVenda INT NOT NULL, valorCusto INT NOT NULL, nomeProduto varchar(30) NOT NULL, codProduto varchar(30) NULL, quantidade INT NOT NULL, PRIMARY KEY (id));
CREATE TABLE IF NOT EXISTS Compra (id INT NOT NULL AUTO_INCREMENT, dataCompra date NOT NULL, valorTotal decimal(10, 2) NOT NULL, codRastreio varchar(20), gastoAdicional decimal(10, 2), statusRecebimento varchar(20) NOT NULL, PRIMARY KEY (id), idFornecedor INT NOT NULL);
CREATE TABLE IF NOT EXISTS ItemVendido (id INT NOT NULL AUTO_INCREMENT, quantidade INT NOT NULL, valorUnitario decimal(10, 2) NOT NULL, valorTotal decimal(10, 2) NOT NULL, PRIMARY KEY (id), idProduto INT NOT NULL);
CREATE TABLE IF NOT EXISTS ItemComprado (id INT NOT NULL AUTO_INCREMENT, quantidadeCompra INT NOT NULL, valorCompra decimal(5, 2) NOT NULL, PRIMARY KEY (id), idProduto INT NOT NULL, idCompra INT NOT NULL);
CREATE TABLE IF NOT EXISTS Devolucao (id INT NOT NULL, dataDevolucao date NOT NULL, gastosAdicionais decimal(5, 2) NOT NULL, formadeVolucao varchar(20) NOT NULL, motivoDevolucao varchar(20) NOT NULL, PRIMARY KEY (id), idVendido INT NOT NULL);
CREATE TABLE IF NOT EXISTS Fornecedor (id INT NOT NULL AUTO_INCREMENT, cnpj varchar(15), telefone varchar(20), tipo varchar(30), PRIMARY KEY(id));
ALTER TABLE Funcionario ADD FOREIGN KEY (idPessoa) REFERENCES Pessoa(id) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE Cliente ADD FOREIGN KEY (idPessoa) REFERENCES Pessoa(id) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE Venda ADD FOREIGN KEY (idFuncionario) REFERENCES Funcionario(id) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE Venda ADD FOREIGN KEY (cpfCliente) REFERENCES Cliente(cpf) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE ItemVendido ADD FOREIGN KEY (idProduto) REFERENCES Produto(id) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE ItemComprado ADD FOREIGN KEY (idProduto) REFERENCES Produto(id) ON DELETE RESTRICT ON UPDATE CASCADE, ADD FOREIGN KEY (idCompra) REFERENCES Compra(id) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE Devolucao ADD FOREIGN KEY (idVendido) REFERENCES ItemVendido(id) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE Compra ADD FOREIGN KEY (idFornecedor) REFERENCES Fornecedor(id) ON DELETE RESTRICT ON UPDATE CASCADE;
CREATE TABLE IF NOT EXISTS Venda_ItemVendido (idVenda int, idItemvendido int, FOREIGN KEY (idVenda) REFERENCES Venda(id) ON DELETE CASCADE ON UPDATE CASCADE, FOREIGN KEY (idItemVendido) REFERENCES ItemVendido(id) ON DELETE CASCADE ON UPDATE CASCADE);